<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>메인</title>
  <meta name="theme-color" content="#1A2E2E" />
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon-96x96.png') }}" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon-32x32.png') }}" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon-16x16.png') }}" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css">
  <script src="{{ url_for('static', filename='script/tailwind-config.js') }}"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
  <script src="https://unpkg.com/cal-heatmap/dist/plugins/CalendarLabel.min.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='script/common.js') }}"></script>
  <script src="{{ url_for('static', filename='script/main.js') }}" defer></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/heatmap.css') }}">
</head>

<body class="min-h-screen bg-jungle text-jungle/90 antialiased font-sans">
  <main class="min-h-screen flex items-start md:items-center justify-center p-6">
    <section class="w-full max-w-xl bg-white rounded-[28px] shadow-xl ring-1 ring-jungle/10 overflow-hidden">
      <!-- Header / Streak -->
      <header class="px-6 sm:px-8 pt-8">
        <div class="flex items-center justify-end">
          <button id="logoutBtn" aria-label="로그아웃" title="로그아웃"
            class="p-2 -m-2 rounded-lg text-jungle/60 hover:bg-jungle/5 hover:text-jungle">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <!-- Door frame: left, top, bottom -->
              <path d="M4 4h10M4 20h10M4 4v16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              <!-- Arrow to the right -->
              <path d="M14 12h8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M18 8l4 4-4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <h1 class="mt-2 text-2xl sm:text-3xl font-extrabold text-jungle tracking-tight flex items-center gap-2">
          <span>2025년 10월 2일</span>
          <span class="text-jungle/40">·</span>
          <span class="text-accent">{{ my_streak }} days streak!!</span>
          <span class="ml-1">🔥</span>
        </h1>

        <!-- Optional badges to add interest -->
        <div class="mt-3 flex flex-wrap items-center gap-2">
          <span
            class="inline-flex items-center gap-1 rounded-full bg-accent/15 text-jungle px-3 py-1 text-xs font-semibold ring-1 ring-inset ring-accent/30">
            🏆 연속 최고 기록: <span class="font-bold">{{ my_best_streak }}</span>일
          </span>
          <span
            class="inline-flex items-center gap-1 rounded-full bg-jungle/5 text-jungle px-3 py-1 text-xs font-semibold ring-1 ring-inset ring-jungle/10">
            📅 이번 달 참여: <span class="font-bold">{{ my_month }}</span>
          </span>
        </div>
      </header>

      <!-- Content -->
      <div class="px-6 sm:px-8 pt-6 pb-8 space-y-6">
        <!-- Statistics -->
        <section>
          <h2 class="text-xs font-extrabold tracking-wider text-jungle/50 uppercase">Statistics</h2>
          <div class="mt-2 text-sm text-jungle/80 space-y-1.5">

            <p>오늘의 결산:<span class="font-semibold">{{ "%.0f"|format((today_til_count/total_user_count)*100 if total_user_count > 0 else 0) }}%</span><span class="text-jungle/50">({{ today_til_count }}명 / {{ total_user_count }}명)</span></p>
            <p>어제의 결산:<span class="font-semibold">{{ "%.0f"|format((yesterday_til_count/total_user_count)*100 if total_user_count > 0 else 0) }}%</span><span class="text-jungle/50">({{ yesterday_til_count }}명 / {{ total_user_count }}명)</span></p>
          </div>
        </section>

        <!-- Heatmap placeholder -->
        <section class="relative">
          <h2 class="text-xs font-extrabold tracking-wider text-jungle/50 uppercase">TIL Calendar</h2>
          <div class="mt-3 rounded-xl ring-1 ring-inset ring-jungle/10 bg-jungle/[0.03] p-4 overflow-hidden">
            <!-- Replace this with your actual heatmap implementation -->
            <div id="heatmap" class="grid grid-cols-14 gap-1.5">
              <div id="cal-heatmap" class="m-0 mx-auto"></div>
            </div>
          </div>
        </section>

        <!-- CTA Button -->
        <div class="pt-2">
          <a href="/list"
            class="block w-full text-center rounded-xl bg-neutral-700 text-white font-bold py-3 ring-1 ring-neutral-700/20 shadow transition hover:brightness-95 active:translate-y-px">
            오늘의 TIL 기록 보러가기
          </a>
        </div>
      </div>
    </section>
  </main>
  <!-- 푸시 알림 구독 요청 팝업(모달) -->
  <div id="push-notification-modal" style="display: none;" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-[1000] w-[min(92vw,28rem)]
                  rounded-xl bg-white ring-1 ring-jungle/10 shadow-xl px-5 py-4 text-center">
    <h4 class="m-0 text-s font-bold text-jungle">알림을 허용하시겠어요?</h4>
    <p class="mt-2 mb-4 text-sm text-jungle/60">허용해주시면 장기간 미사용 시 재방문을 위한 알림을 보내드립니다.</p>
    <div class="flex items-center justify-center gap-2">
      <button id="push-accept-btn"
        class="px-3.5 py-2 rounded-lg bg-accent text-jungle font-semibold ring-1 ring-accent/30 shadow transition hover:brightness-95 active:translate-y-px">
        허용
      </button>
      <button id="push-deny-btn"
        class="px-3.5 py-2 rounded-lg bg-jungle/5 text-jungle ring-1 ring-jungle/10 transition hover:bg-jungle/10">
        나중에
      </button>
    </div>
  </div>

  <!-- 푸시 알림 통합 스크립트 -->
  <script src="{{ url_for('static', filename='script/push_integration.js') }}"></script>
</body>

</html>
